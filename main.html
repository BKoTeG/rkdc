<!DOCTYPE html>
<head>
<title>Hej</title>
</head>
<body>

<canvas id="MainCanvas"></canvas>
</canvas>

<audio id="BgAudio" autoplay="autoplay" loop></audio> 

<br>
<button id="onoff" type="button">Muzyka on/off</button>
<button id="next" type="button">Nastepna piosenka</button>

<script>
var bgm = document.getElementById("BgAudio"); 				//bgaudio
bgm.volume = 0.02;
bgm.src = "http://catcut.net/QDyv";

var mute = document.getElementById("onoff");				//pocisk dla muzyki on/off
var i = 1;

var nextS = document.getElementById("next");				//nastepna piosenka
var S = 1;
var list = ["http://catcut.net/QDyv" ,
 "http://f.marvarid.net/mp3/Rus/Thomas_Mraz_-_Ya_Protiv_Vseh.mp3" ,
 "http://f.marvarid.net/mp3/Rus/Gryaznyj_Ramires_-_Magnitude.mp3" , 
 "http://f.marvarid.net/mp3/Rus/Gazirovka_-_Black.mp3"];

var canvas = document.getElementById("MainCanvas");			//tworzenie canvas
var ctx = canvas.getContext("2d");							//2d, t.z. plaszczyzna

var temp_w = document.documentElement.clientWidth / 8;		//dynamicznie dopasowanie rozmiaru
var temp_h = document.documentElement.clientHeight / 16;

var c_width = document.documentElement.clientWidth - temp_w;
var c_height = document.documentElement.clientHeight - temp_h;

canvas.setAttribute("width", c_width);						//dopasowanie rozmiaru canvasu do rozmiaru okna
canvas.setAttribute("height", c_height);
canvas.style.background = "black";
canvas.style.cursor = "none";								//wylaczenia kursoru


var ballRadius = 10;										//rozmiar pilki
var x = canvas.width/2;										//polozenia poczatkowe 
var y = canvas.height-30;
var vx = 2;													//predkosc
var vy = -2;

var paddle_h = 20;											//ustawienia rozmiaru plaszczyzny dla odbicia
var paddle_w = 340;
var paddle_x = (canvas.width - paddle_w)/2;					//wspol.; y nie jest potrzebny(chyba)


mute.onclick = function(){									//funkcja do on/off muzyki
	if (i%2==1){
	bgm.volume = 0.0; 
	}
	else{
	bgm.volume = 0.02; 
	}
	i++;
}

nextS.onclick = function(){									//funkcja dla wloczenia nastepnej piosenki
	bgm.src = list[S];
	S++;
	if (S==4){S=0}
}

function playAudio(){										//funkcja dzwieku
	var myAudio = new Audio;
	myAudio.src = "https://sound-pack.net/download/Sound_11994.wav";
	myAudio.play();
}

function random(number){									//funkcja generujaca losowy liczby
	return Math.floor(Math.random()*(number+1));
}

function rndColor(){
	rndCol = 'rgb(' + random(255) + ',' + random(255) + ',' + random(255) + ')';	//zmienna rndCol jaka generuje losowyj kolor
	return rndCol;
}

function drawBall() {										//namalowac pilku
    ctx.beginPath();										//tworzenie szlaku
    ctx.arc(x, y, ballRadius, 0, Math.PI*2);				//tworzenie pilki na canvas
    ctx.fillStyle = rndColor();								//kolor pilki (losowyj)
    ctx.fill();												//zastosowanie koloru
    ctx.closePath();
}

function drawPaddle() {										//namalowac plaszczyznu
    ctx.beginPath();
    ctx.rect(paddle_x, canvas.height - paddle_h, paddle_w, paddle_h);
    ctx.fillStyle = "#FF0000";
    ctx.fill();
    ctx.closePath();
}

document.getElementById("MainCanvas").onmousemove = function(event) {moving(event)};	//funkcja dla kierowania plaszczyzna za pomocy myszy
function moving(e) {
    paddle_x = e.clientX - (paddle_w/2);
}

function draw() {													//glowna funkcja

    ctx.clearRect(0, 0, canvas.width, canvas.height);
	drawPaddle();
    drawBall();
	
	if(x + vx > canvas.width - ballRadius || x + vx < ballRadius) {	//odbicie od scian
        vx = -vx;
    }
	
    if(y + vy < ballRadius) {
        vy = -vy;
    }
	
	if(y + vy > (canvas.height - paddle_h - ballRadius)){			//odbicie od plaszczyzny (juz dobrze dziala)
		if(x > paddle_x && x < paddle_x + paddle_w){
			vy = -vy;
			playAudio();											//dzwiek przy dotyku plaszczyzny
		}
		else if (y + vy > canvas.height-ballRadius){
		alert("u lost");
		}
	}
	

	
	x += vx;														//zmiana polozenia
    y += vy;
	
}

setInterval(draw, 10);												//powtorzenie funkcji

</script>
</body>
</html>